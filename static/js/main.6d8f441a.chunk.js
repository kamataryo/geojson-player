(this["webpackJsonpgeojson-player"]=this["webpackJsonpgeojson-player"]||[]).push([[0],{34:function(e,t,r){},36:function(e,t,r){},40:function(e,t){},48:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(8),s=r.n(o),c=(r(34),r(12)),i=r(6),u=r.n(i),d=r(7),l=r(5),p=(r(36),r(28)),g=r(13),f=r(18),b=r.n(f),m=r(23),y=r.n(m),j=r(24),h=function(e){var t=Object(l.a)(e,3),r=t[0],n=t[1];t[2];return[r,n]},w=function(e,t){return new Promise((function(r,n){var a=new FileReader;a.onload=function(){if("GeoJSON"===t)try{var e=JSON.parse(a.result);if(!e.features||"LineString"!==e.features[0].geometry.type||!Array.isArray(e.features[0].properties.coordTimes)||e.features[0].properties.coordTimes.length!==e.features[0].geometry.coordinates.length)throw new Error;r(e)}catch(i){console.error(i);var o=new Error("Should be a GeoJSON with LineString.");n(o)}else try{var s=function(e){var t=(new j.DOMParser).parseFromString(e),r=y.a.gpx(t);return r.features[0].geometry.coordinates=r.features[0].geometry.coordinates.map(h),r}(a.result);r(s)}catch(i){console.error(i);var c=new Error("Should be a valid GPX.");n(c)}},a.onerror=function(e){console.error(e);var t=new Error("Failed to read the file.");n(t)},a.readAsText(e)}))},v=function(e){return new Promise((function(t){return setTimeout(t,e)}))},x=function(e){var t="",r=[],n=e.captureStream(120),a=new MediaRecorder(n,{mimeType:"video/webm; codecs=vp9"});return a.ondataavailable=function(e){r.push(e.data)},a.onstop=function(){var e=new Blob(r,{type:"video/webm"});t=URL.createObjectURL(e)},{startRecord:function(){a.start()},stopRecord:function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.stop();case 1:if(t){e.next=6;break}return e.next=4,v(10);case 4:e.next=1;break;case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}},O=function(e,t,r,n){var a=n.speed,o={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}}]};return r.addSource("gp-growing-line",{type:"geojson",data:o}),r.addSource("gp-growing-ends",{type:"geojson",data:t}),r.addLayer({id:"gp-growing-line",type:"line",source:"gp-growing-line",layout:{},paint:{"line-width":3,"line-color":"red"}}),r.addLayer({id:"gp-growing-ends-start",type:"circle",source:"gp-growing-ends",layout:{},filter:["==","isStart",!0],paint:{"circle-radius":8,"circle-color":"red"}}),new Promise((function(t){var n,s=(new Date).getTime(),c=0;!function i(){n=requestAnimationFrame(i);for(var u=((new Date).getTime()-s)*a,d=e.features[0].properties.durations||[];u>d[c];){var l=e.features[0].geometry.coordinates[c];o.features[0].geometry.coordinates.push(l),c++}r.getSource("gp-growing-line").setData(o),o.features[0].geometry.coordinates.length>=e.features[0].geometry.coordinates.length&&(r.addLayer({id:"gp-growing-ends-end",type:"circle",source:"gp-growing-ends",layout:{},filter:["==","isEnd",!0],paint:{"circle-radius":8,"circle-color":"red"}}),cancelAnimationFrame(n),t())}()}))},S=function(e){var t=document.createElement("a");t.href=e,t.download="movie.webm",document.body.appendChild(t),t.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),document.body.removeChild(t)},k=r(27),C=r.n(k),L=r(25),F=r.n(L),P=r(2);var T=function(){var e=Object(n.useState)(),t=Object(l.a)(e,2),r=t[0],a=t[1],o=Object(n.useState)(),s=Object(l.a)(o,2),i=s[0],f=s[1],m=Object(n.useState)(100),y=Object(l.a)(m,2),j=y[0],h=y[1],k=Object(n.useState)(!1),L=Object(l.a)(k,2),T=L[0],E=L[1],N=Object(n.useRef)(),R=Object(n.useCallback)(function(){var e=Object(d.a)(u.a.mark((function e(t){var r,n,o,s,c,i,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t[0]).name.toLocaleLowerCase().endsWith(".gpx")){e.next=7;break}return e.next=4,w(r,"GPX");case 4:n=e.sent,e.next=14;break;case 7:if(!r.name.toLowerCase().endsWith(".geojson")){e.next=13;break}return e.next=10,w(r,"GeoJSON");case 10:n=e.sent,e.next=14;break;case 13:return e.abrupt("return");case 14:for(o=0;o<n.features[0].geometry.coordinates.length;o++)n.features[0].properties.durations||(n.features[0].properties.durations=[]),s=n.features[0].properties.coordTimes[0],c=n.features[0].properties.coordTimes[o],n.features[0].properties.durations.push(new Date(c).getTime()-new Date(s).getTime());i=n.features[0].geometry.coordinates.length,d={type:"FeatureCollection",features:[{type:"Feature",properties:{isStart:!0},geometry:{type:"Point",coordinates:n.features[0].geometry.coordinates[0]}},{type:"Feature",properties:{isEnd:!0},geometry:{type:"Point",coordinates:n.features[0].geometry.coordinates[i-1]}}]},a(n),f(d);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),D=Object(n.useCallback)((function(e){N.current=e,e.on("load",(function(){if(r&&i){var t=r.features[0].geometry.coordinates.reduce((function(e,t){return e.extend(t)}),new(window.mapboxgl||window.maplibregl).LngLatBounds(r.features[0].geometry.coordinates[0],r.features[0].geometry.coordinates[0]));e.fitBounds(t,{padding:50,duration:2e3}),e.addSource("gp-base-ends",{type:"geojson",data:i}),e.addSource("gp-base-line",{type:"geojson",data:r}),e.addLayer({id:"gp-base-ends",type:"circle",source:"gp-base-ends",layout:{},paint:{"circle-radius":8,"circle-color":"red"}}),e.addLayer({id:"gp-base-line",type:"line",source:"gp-base-line",layout:{},paint:{"line-width":3,"line-color":"red","line-dasharray":[3,3]}})}}))}),[r,i]),G=Object(n.useCallback)((function(e){h(parseInt(e.currentTarget.value))}),[]),J=Object(n.useCallback)(Object(d.a)(u.a.mark((function e(){var t,n,a,o,s,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=N.current)&&r&&i)){e.next=23;break}return n=t.getCanvas(),a=x(n),o=a.startRecord,s=a.stopRecord,t.removeLayer("gp-base-line"),t.removeSource("gp-base-line"),t.removeLayer("gp-base-ends"),t.removeSource("gp-base-ends"),e.next=10,v(1e3);case 10:return E(!0),o(),e.next=14,v(4e3);case 14:return e.next=16,O(r,i,t,{speed:j});case 16:return e.next=18,v(4e3);case 18:return e.next=20,s();case 20:c=e.sent,E(!1),S(c);case 23:case"end":return e.stop()}}),e)}))),[r,i,j]),A=Object(n.useCallback)(Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),[]);if(r&&i&&r.features[0].properties&&r.features[0].properties.durations){var B=r.features[0].geometry.coordinates.length,I=r.features[0].properties.durations[B-1];return Object(P.jsxs)(g.a,{style:{width:"100%",height:"100%"},"data-hash":"on",onLoad:D,children:[Object(P.jsxs)(g.a.Control,{containerProps:{className:"slider-control speed-control maplibregl-ctrl mapboxgl-ctrl"},position:"top-left",children:[Object(P.jsx)("label",{htmlFor:"speed",children:"speed"}),Object(P.jsx)("input",{id:"speed",className:"slider",type:"range",min:1,max:1e4,value:j,onChange:G,disabled:T}),Object(P.jsx)("span",{children:"x ".concat(j," (").concat(Math.round(100*I/(1e3*j))/100," sec.)")})]}),Object(P.jsx)(g.a.Control,{containerProps:{className:b()("button-control","record-start-control","maplibregl-ctrl","mapboxgl-ctrl","maplibregl-ctrl-group","mapboxgl-ctrl-group")},position:"top-left",children:Object(P.jsx)("button",{onClick:T?A:J,style:{display:"flex",justifyContent:"center",alignItems:"center"},children:T?Object(P.jsx)(F.a,{sx:{color:"red"}}):Object(P.jsx)(C.a,{})})})]})}return Object(P.jsx)(p.a,{onDrop:R,children:function(e){var t=e.getRootProps,r=e.getInputProps,n=e.isDragActive;return Object(P.jsx)("section",Object(c.a)(Object(c.a)({className:b()("dropzone",n?"dragging":"")},t()),{},{children:Object(P.jsxs)("div",{className:"inside",children:[Object(P.jsx)("input",Object(c.a)({},r())),Object(P.jsx)("p",{children:"GeoJSON \u307e\u305f\u306f GPX \u3092\u30c9\u30ed\u30c3\u30d7"})]})}))}})},E=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,55)).then((function(t){var r=t.getCLS,n=t.getFID,a=t.getFCP,o=t.getLCP,s=t.getTTFB;r(e),n(e),a(e),o(e),s(e)}))};s.a.render(Object(P.jsx)(a.a.StrictMode,{children:Object(P.jsx)(T,{})}),document.getElementById("root")),E()}},[[48,1,2]]]);
//# sourceMappingURL=main.6d8f441a.chunk.js.map